<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.0">
<title data-rh="true">One post tagged with &quot;homebrew&quot; | Pyrsia.io</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pyrsia.io/blog/tags/homebrew/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="all"><meta data-rh="true" property="og:title" content="One post tagged with &quot;homebrew&quot; | Pyrsia.io"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://pyrsia.io/blog/tags/homebrew/"><link data-rh="true" rel="alternate" href="https://pyrsia.io/blog/tags/homebrew/" hreflang="en"><link data-rh="true" rel="alternate" href="https://pyrsia.io/blog/tags/homebrew/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Pyrsia.io RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Pyrsia.io Atom Feed">



<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-WZ4WCZ8",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4e755c1c.css">
<link rel="preload" href="/assets/js/runtime~main.887d6a0a.js" as="script">
<link rel="preload" href="/assets/js/main.1be151fe.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-pyrsia.svg" alt="Pyrsia logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-pyrsia.svg" alt="Pyrsia logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/vision/">Vision</a><a class="navbar__item navbar__link" href="/docs/tutorials/quick-installation/">Tutorials</a><a class="navbar__item navbar__link" href="/docs/community/get_involved/">Get Involved</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a><a href="https://github.com/pyrsia" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/13/pyrsia-0.2.3-released/">Release 0.2.3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/05/authority_nodes/">Authority Nodes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/30/pyrsia-anniversary-recap/">Pyrsia Anniversary Recap</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/20/pyrsia-0.2.2-released/">Release 0.2.2</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/20/using-libp2p-to-take-over-the-world-2022-ipfs-camp/">How Pyrsia is Using libp2p to Take Over the World!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/02/create-macOS-brew-installer-for-rust-binary/">Create macOS Installer for Rust Binary App</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/30/pyrsia-0.2.1-released/">Release 0.2.1</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/10/why-does-pyrsia-use-a-blockchain/">Why does Pyrsia use a Blockchain(and no CryptoCurrency)?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/30/why-pyrsia-is-being-built-in-rust/">Why Pyrsia is being built in Rust?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/03/peer-metrics/">Peer Metrics in the Pyrsia Network</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/28/blockchain-consensus/">Blockchain Consensus</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;homebrew&quot;</h1><a href="/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/12/02/create-macOS-brew-installer-for-rust-binary/">Create macOS Installer for Rust Binary App</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-02T00:00:00.000Z" itemprop="datePublished">December 2, 2022</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo" src="https://github.com/dasmanas.png" alt="Manas Das"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Manas Das</span></div><small class="avatar__subtitle" itemprop="description">Pyrsia Contributor</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Recently the Rust programming language has enjoyed the success and thrilled the many developers specially working on
System Level Software and building decentralized applications. When releasing your software, it is usually desirable to
provide an easy to use installer for end users, ideally reducing the configuration burden on users and providing
individual developers with control of how the application should function at the end users environment.</p><p>There are advantages of having installers for your binaries and a few are mentioned here. </p><ul><li>User doesn&#x27;t need to provide any configuration, environment variables or base directories for the binary to run on users
machine. Rather software manufacturer packages those defaults with the installer.</li><li>User can be alerted in the event of a new version release of the software.</li><li>Developer can have more control on managing context of the app, providing backward compatibility, cleaning up storage
used by the app.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-a-small-binary-app-in-rust--create-an-installer">Build a small binary app in Rust &amp; Create an Installer<a class="hash-link" href="#build-a-small-binary-app-in-rust--create-an-installer" title="Direct link to heading">​</a></h2><p>In this sections we will build a small rust binary and an installer for macOS using <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">Homebrew</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-code-for-the-rust-binary">Sample code for the rust binary<a class="hash-link" href="#sample-code-for-the-rust-binary" title="Direct link to heading">​</a></h3><p>In this example we will exercise a basic rust binary application to demonstrate how to build an installer. The rust program
which listens to a TCP Socket and write the text message on to listener&#x27;s standard output (i.e. stdout) stream. The
program also has an option to set the port from an environment variable. Final goal is to run the software as a
background process and log the text to Listener&#x27;s output stream whenever any other application sends message to the
socket.</p><p>Let&#x27;s create a rust project named <code>rust_app</code> using <code>cargo new rust_app --bin</code>. It will create binary project structure
as below.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sample_rust_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Cargo.lock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Cargo.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── main.rs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Content of Cargo.toml</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[package]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = &quot;rust_app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version = &quot;0.1.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">edition = &quot;2021&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A very simple <code>main.rs</code> which listens on a port and writes the content into the STDOUT stream.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use std::env;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::io;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::io::{BufRead, Error};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::net::{TcpListener, TcpStream};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() -&gt; std::io::Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let port = env::var(&quot;LISTEN_PORT&quot;).unwrap_or(String::from(&quot;8080&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let listener = TcpListener::bind(format!(&quot;127.0.0.1:{}&quot;, port))?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // accept connections and process them serially</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for stream in listener.incoming() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_client(stream?)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ok(())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn handle_client(mut stream: TcpStream) -&gt; Result&lt;(), Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let mut reader = io::BufReader::new(&amp;mut stream);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let received: Vec&lt;u8&gt; = reader.fill_buf()?.to_vec();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reader.consume(received.len());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String::from_utf8(received)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .map(|msg| println!(&quot;{}&quot;, msg))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .map_err(|_| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            io::Error::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              io::ErrorKind::InvalidData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;Couldn&#x27;t parse received string as utf8&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="build">Build<a class="hash-link" href="#build" title="Direct link to heading">​</a></h3><p>Build the binary project using <code>cargo build --all-targets --workspace --release</code>. On successful build completion, binary
will be placed under <code>target/release/</code> directory. Let&#x27;s try the binary with a sample input.</p><p>Run the binary while setting <code>LISTEN_PORT</code> to <code>9090</code> to accept messages on localhost 9090 TCP port.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">LISTEN_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ./target/release/rust_app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We are going to use netcat client to send message to TCP socket like below.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">echo</span><span class="token plain"> sample_text </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nc</span><span class="token plain"> localhost </span><span class="token number" style="color:#36acaa">9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now check the rust_app program terminal. It will show the same text i.e. <code>sample_text</code> which we sent through netcat
client.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upload-archive-in-cloud-storage">Upload Archive in Cloud Storage<a class="hash-link" href="#upload-archive-in-cloud-storage" title="Direct link to heading">​</a></h3><p>Now we will concentrate how to build an installer for macOS. We choose Homebrew package manager. Homebrew requires a URL
to download your binary. There are a few choices to host your executable, like any cloud provider with file storage
service or may be GitHub Releases. For the current use case, I am using GitHub Releases because it is free and easy to
use.</p><p>From the rust source code example, the binary is archived (using <code>tar -C target/release -czf rust_app.tar.gz rust_app</code>)
and uploaded into a GitHub release and is available under
<a href="https://github.com/dasmanas/homebrew-rust-app/releases/download/v0.0.1/rust_app.tar.gz" target="_blank" rel="noopener noreferrer">https://github.com/dasmanas/homebrew-rust-app/releases/download/v0.0.1/rust_app.tar.gz</a> link. We will require this link
in the installation instruction.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="homebrew-to-create-the-macos-installer">Homebrew to Create the macOS Installer<a class="hash-link" href="#homebrew-to-create-the-macos-installer" title="Direct link to heading">​</a></h3><p>Homebrew offers a way to install formula from third party repositories (i.e. Taps) like GitHub repositories instead of
having it as part of core homebrew formula <a href="https://github.com/Homebrew/homebrew-core" target="_blank" rel="noopener noreferrer">homebrew-core</a>. We will create
one such GitHub project to host our formula. GitHub project name is <code>homebrew-rust-app</code> while following the naming
convention <code>homebrew-&lt;project_name&gt;</code> to have better convenience for the user while tapping the repository.</p><p>We will create the homebrew project in following structure which will hold the Ruby formula file under Formula directory
like shown here.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">homebrew-rust-app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Formula</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── listener.rb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── README.md</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Ruby file contains the installation instruction of your binary. Here is a sample ruby file for the formula. Here we
will try to achieve a few things for our example.</p><ul><li>A macOS installer for the binary.</li><li>User of the software doesn&#x27;t need manage any configuration. Defaults (config, env vars etc.) will be manage as part of
the installation.</li><li>Install the software under a managed directory by Homebrew. This gives more control to the software manufacturer to
support backward compatibility or cleaning up memory in at times specially during software version update.</li><li>An installer which can be run as background service.</li><li>Sample test case for the installer which can be performed even before starting the installer as background service
will provide a better determine if there is any potential issue.</li></ul><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Listener &lt; Formula</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  desc &quot;A small description of your formula&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # A home page URL for your software</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  homepage &quot;https://github.com/dasmanas/homebrew-rust-app/releases&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # URL from where the installer archive is available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  url &quot;https://github.com/dasmanas/homebrew-rust-app/releases/download/v0.0.1/rust_app.tar.gz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Sha256 can be calculated using &quot;shasum -a 256 &lt;archive_name.tar.gz&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sha256 &quot;c19c678e755d98506c372dd631640702ef2b7da225ffaee20453deb0c2b4a213&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  license &quot;Apache-2.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version &quot;0.0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ENV.deparallelize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Installing the app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bin.install &quot;rust_app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def post_install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Instruction to create a directory which may be used to manage file resources for the app. rust_app directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # will be created under /usr/local/var directory.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (var/&quot;rust_app&quot;).mkpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Section to add different instruction for the user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def caveats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s = &lt;&lt;~EOS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      We&#x27;ve installed your rust_app.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      To test rust_app installation:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        brew test listener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      To run rust_app Node as a background service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        brew services start listener </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      To check the service status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        brew services list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      To stop rust_app Node background service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        brew services stop listener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EOS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def envvarhash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return {PATH: std_service_path_env, LISTEN_PORT: &quot;9090&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run [opt_bin/&quot;rust_app&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keep_alive true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_type :background</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment_variables envvarhash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_path var/&quot;rust_app/logs/stdout/rust_app.log&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_log_path var/&quot;rust_app/logs/stdout/rust_app.log&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    working_dir var/&quot;rust_app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (testpath/&quot;rust_app&quot;).mkpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (testpath/&quot;tmp&quot;).mkpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    puts testpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    child_pid = fork do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      puts &quot;Child process initiated to run rust_app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      puts &quot;Child pid: #{Process.pid}, pgid: #{Process.getpgrp}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      #setsid() creates a new session if the calling process is not a process group leader.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Process.setsid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      puts &quot;Child new pgid: #{Process.getpgrp}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      puts &quot;Initiating rust_app...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ENV.prepend &quot;LISTEN_PORT&quot;, &quot;9090&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      system &quot;#{bin}/rust_app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    puts &quot;Waiting for rust_app TCP socket listener to be up...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleep 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      system &quot;echo sample_text | nc localhost 9090&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert_match &quot;rust_app&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   shell_output(&quot;lsof -nP -i4TCP:9090 | grep LISTEN&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rescue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      puts &quot;test1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert_raises(CustomError) do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        raise CustomError, &#x27;This is really bad&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ensure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pgid = Process.getpgid(child_pid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      puts &quot;Sending HUP to group #{pgid}...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Process.kill(&#x27;HUP&#x27;, -pgid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Process.detach(pgid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      puts &quot;Parent process exiting...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the ruby script, the section <code>service do ... end</code> takes care of registering the software as background service. The
block of ruby script creates the required plist file under <code>~/Library/LaunchAgents/</code> for the Launch Agents. At the same
time it eliminates the need of handcrafted plist file. For more information you can always refer to Homebrew&#x27;s
<a href="https://docs.brew.sh/Formula-Cookbook#service-files" target="_blank" rel="noopener noreferrer">Service files</a> official doc.</p><p>We also added a <code>test do ... end</code> section to the ruby script to demonstrate the test capability. User can run a test on
the installer even before starting the same as a service. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-install-your-software-as-service">How to install your software as service<a class="hash-link" href="#how-to-install-your-software-as-service" title="Direct link to heading">​</a></h3><p>Now it is ready to release the installer. To use the installer in macOS, here are some important tips.</p><ul><li>Tap the third party repository for the brew formula. E.g. <code>brew tap dasmanas/rust-app</code>.</li><li>Install the formula from the tap. E.g. <code>brew tap listener</code></li><li>Test the installed binary. E.g. <code>brew test listener</code></li><li>Install the binary as service. E.g. <code>brew services start listener</code>. Once service has started as background process,
the status of the service can be verified using <code>brew services list</code>.</li><li>Background service can be stopped at any time using brew&#x27;s services utility. E.g. <code>brew services stop listener</code></li></ul><p>In Pyrsia we built similar kind of installer for macOS. If you are a macOS user, you may also like to take a
look at the code base from <a href="https://github.com/pyrsia/homebrew-pyrsia" target="_blank" rel="noopener noreferrer">homebrew-pyrsia</a> or try out
<a href="/docs/tutorials/quick-installation/">Quick Installation</a> guide to install Pyrsia. For any improvement suggestion or to
contribute open issue or pull request accordingly under <a href="https://github.com/pyrsia" target="_blank" rel="noopener noreferrer">Pyrsia</a> project.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rust/">rust</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/macos/">macos</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/installer/">installer</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/homebrew/">homebrew</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/brew/">brew</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/tags/">Blog Categories</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://groups.google.com/g/pyrsia" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://cdeliveryfdn.slack.com/join/shared_invite/zt-1eryue9cw-9YpgrfIfsTcDS~hGHchURg" target="_blank" rel="noopener noreferrer" class="footer__link-item">CDF Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UClPQKloIElvJk7EdSST3W5g" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/PyrsiaOSS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/#team">The Team</a></li><li class="footer__item"><a href="https://drive.google.com/file/d/13nOwuFGMDwC-S6mUkhSopC0sFMTo__uE/view?usp=sharing" target="_blank" rel="noopener noreferrer" class="footer__link-item">Technical Charter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/pyrsia" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://drive.google.com/drive/folders/1HVw3WARxg7LKEh22_lLkesVhqFmKj5r7?usp=share_link" target="_blank" rel="noopener noreferrer" class="footer__link-item">Shared Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/pyrsia" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/icon-pyrsia-torch-175.svg" alt="Pyrsia Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="118" height="183"><img src="/img/icon-pyrsia-torch-175.svg" alt="Pyrsia Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="118" height="183"></div><div class="footer__copyright"><br><br>
                        <a href="https://cd.foundation" target="_blank"><img src="/img/logo-cdf.png" style="width:100%;max-width:400px;"></a><br>
                        Pyrsia is a Continuous Delivery Foundation project.
                        <br><br>
                      Copyright © Pyrsia a Series of LF Projects, LLC. <br>
                      For website terms of use, trademark policy and other project policies please see <a href="https://lfprojects.org">https://lfprojects.org</a>.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.887d6a0a.js"></script>
<script src="/assets/js/main.1be151fe.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WZ4WCZ8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>