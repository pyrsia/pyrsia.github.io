(self.webpackChunkpyrsia=self.webpackChunkpyrsia||[]).push([[6699],{55518:function(e,t,a){"use strict";a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return k},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return m}});var n=a(87462),r=a(63366),s=(a(67294),a(3905)),i=(a(8209),["components"]),l={custom_edit_url:"https://github.com/pyrsia/pyrsia/blob/main/docs/SRE/eks-setup.md"},o="AWS EKS Setup",p={unversionedId:"SRE/eks-setup",id:"SRE/eks-setup",title:"AWS EKS Setup",description:"1. Generate Access keys for CLI, SDK, & API access",source:"@site/docs/SRE/eks-setup.md",sourceDirName:"SRE",slug:"/SRE/eks-setup",permalink:"/docs/SRE/eks-setup",draft:!1,editUrl:"https://github.com/pyrsia/pyrsia/blob/main/docs/SRE/eks-setup.md",tags:[],version:"current",frontMatter:{custom_edit_url:"https://github.com/pyrsia/pyrsia/blob/main/docs/SRE/eks-setup.md"},sidebar:"tutorialSidebar",previous:{title:"Template",permalink:"/docs/community/rfc/sample_rfc"},next:{title:"Google GKE Setup",permalink:"/docs/SRE/gke-setup"}},u={},m=[],c={toc:m};function k(e){var t=e.components,l=(0,r.Z)(e,i);return(0,s.kt)("wrapper",(0,n.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"aws-eks-setup"},"AWS EKS Setup"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Generate Access keys for CLI, SDK, & API access"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-1#/security_credentials"},"Create Access Key"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"aws configure"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Set ",(0,s.kt)("inlineCode",{parentName:"li"},"AWS Access Key ID")),(0,s.kt)("li",{parentName:"ul"},"Set ",(0,s.kt)("inlineCode",{parentName:"li"},"AWS Secret Access Key")),(0,s.kt)("li",{parentName:"ul"},"Set ",(0,s.kt)("inlineCode",{parentName:"li"},"Default region name")))))))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/eks/latest/userguide/eksctl.html"},"Install eksctl"))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Create the Cluster"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"See ",(0,s.kt)("a",{target:"_blank",href:a(82366).Z},"cluster.yaml")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"eksctl create cluster -f cluster.yaml")))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Create Kubernetes Namespaces"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"kubectl create namespace pyrsia-node")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"kubectl create namespace external-dns")))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Create Route 53 Policy"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"See ",(0,s.kt)("a",{target:"_blank",href:a(50647).Z},"route53-policy.json")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'aws iam create-policy --policy-name "AllowExternalDNSUpdates" --policy-document file://route53-policy.json')))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Attach Route 53 Policy"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"aws iam attach-role-policy --role-name $(aws eks describe-nodegroup --cluster-name pyrsianode --nodegroup-name ng-1 --query nodegroup.nodeRole --out text | awk -F/ '{print $2}') --policy-arn $(aws iam list-policies --query 'Policies[?PolicyName=="),"AllowExternalDNSUpdates",(0,s.kt)("inlineCode",{parentName:"li"},"].Arn' --output text)")))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Setup Route 53 Domain"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'aws route53 create-hosted-zone --name "pyrsia-aws.link." --caller-reference "external-dns-$(date +%s)"')))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Get DNS Server List"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"aws route53 list-resource-record-sets --output text --hosted-zone-id $(aws route53 list-hosted-zones-by-name --output json --dns-name \"pyrsia-aws.link.\" | jq -r \".HostedZones[0].Id\") --query \"ResourceRecordSets[?Type == 'NS'].ResourceRecords[*].Value | []\" | tr '\\t' '\\n'")))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Generate Pyrsia Keys using openssl v3"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"openssl genpkey -algorithm Ed25519 -out ed25519.pem\nopenssl pkey -in ed25519.pem -pubout -outform DER | tail -c +13 > id_ed25519.pub\nopenssl pkey -in ed25519.pem -out - -outform DER | tail -c +17 > id_ed25519.pri\ncat id_ed25519.pri id_ed25519.pub > ed25519.ser\n"))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Create DNS Alias"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"route53-alias.json"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'\naws route53 change-resource-record-sets \\\n--hosted-zone-id $(aws route53 list-hosted-zones-by-name --output json --dns-name "pyrsia-aws.link." | jq -r ".HostedZones[0].Id" | cut -d/ -f3) \\\n--change-batch \'\n{\n   "Comment": "Creating Alias resource for boot.nightly.pyrsia-aws.link",\n   "Changes": [\n      {\n         "Action": "CREATE",\n         "ResourceRecordSet": {\n         "Name": "boot.nightly.pyrsia-aws.link",\n         "Type": "A",\n         "AliasTarget": {\n            "DNSName": "pyrsia-node-0.nightly.pyrsia-aws.link",\n            "EvaluateTargetHealth": false,\n            "HostedZoneId": "\'$(aws route53 list-hosted-zones-by-name --output json --dns-name "pyrsia-aws.link." | jq -r ".HostedZones[0].Id" | cut -d/ -f3 )\'"\n         }\n         }\n      }\n   ]\n}\'\n'))))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Deploy Pyrsia via Helm"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("inlineCode",{parentName:"p"},"helm repo update pyrsia-nightly"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("inlineCode",{parentName:"p"},'helm upgrade node1 --install -n pyrsia-node pyrsia-nightly/pyrsia-node --set k8s_provider=eks --set "dnsname=nightly.pyrsia-aws.link" --set bootdns=boot.nightly.pyrsia-aws.link --set keys.p2p=$(cat ed25519.ser | base64) --set keys.blockchain=$(cat ed25519.ser | base64)  --version "0.2.4+2856')),(0,s.kt)("blockquote",{parentName:"li"},(0,s.kt)("p",{parentName:"blockquote"},"Note: The above helm command does not setup the Pyrsia Node to use a Build Node.  ",(0,s.kt)("inlineCode",{parentName:"p"},'--set "buildnode=http://35.193.148.20:8080"')," parameter is needed for build node configuraion.")))))))}k.isMDXComponent=!0},82366:function(e,t,a){"use strict";t.Z=a.p+"assets/files/cluster-714dfc442974499c4a4ef7f0327b2737.yaml"},50647:function(e,t,a){"use strict";t.Z=a.p+"assets/files/route53-policy-166c51b2aaa00a54953285bca3785684.json"},11748:function(e,t,a){var n={"./locale":89234,"./locale.js":89234};function r(e){var t=s(e);return a(t)}function s(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=s,e.exports=r,r.id=11748}}]);