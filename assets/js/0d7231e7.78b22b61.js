(self.webpackChunkpyrsia=self.webpackChunkpyrsia||[]).push([[5722],{42537:(e,t,a)=>{"use strict";a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>o});var n=a(87462),r=(a(67294),a(3905));a(8209);const l={custom_edit_url:"https://github.com/pyrsia/pyrsia/blob/main/docs/SRE/gke-setup.md"},i="Google GKE Setup",p={unversionedId:"SRE/gke-setup",id:"SRE/gke-setup",title:"Google GKE Setup",description:"1. Generate Access keys for CLI, SDK, & API access",source:"@site/docs/SRE/gke-setup.md",sourceDirName:"SRE",slug:"/SRE/gke-setup",permalink:"/docs/SRE/gke-setup",draft:!1,editUrl:"https://github.com/pyrsia/pyrsia/blob/main/docs/SRE/gke-setup.md",tags:[],version:"current",frontMatter:{custom_edit_url:"https://github.com/pyrsia/pyrsia/blob/main/docs/SRE/gke-setup.md"},sidebar:"tutorialSidebar",previous:{title:"AWS EKS Setup",permalink:"/docs/SRE/eks-setup"},next:{title:"Managing Pyrsia on Kubernetes",permalink:"/docs/SRE/kubernetes-helm"}},s={},o=[],c={toc:o};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"google-gke-setup"},"Google GKE Setup"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Generate Access keys for CLI, SDK, & API access"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://cloud.google.com/sdk/docs/install-sdk"},"Install gcloud"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Set your gcloud config"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-toml"},"[compute]\nzone = us-central1-c\n[container]\ncluster = pyrsia-cluster-1\n[core]\ndisable_usage_reporting = False\nproject = pyrsia-sandbox\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Setup Environment Variables"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"CHART_VERSION=0.2.4+2856\nBUILD_CHART_VERSION=0.1.0+7\nCLUSTER_NAME=pyrsia-staging\nEXTERNALDNS_NAMESPACE=external-dns\nPYRSIA_NAMESPACE=pyrsia-node\nPYRSIA_BASE_DOMAIN=pyrsia.link\nPYRSIA_DOMAIN=staging.${PYRSIA_BASE_DOMAIN}\nPYRSIA_BOOTDNS=boot.${PYRSIA_DOMAIN}\nPYRSIA_NODE_ZERO=pyrsia-node-0.${PYRSIA_DOMAIN}\nSERVICE_ACCOUNT=prysia-k8s@pyrsia-sandbox.iam.gserviceaccount.com\nPROJECT=pyrsia-sandbox\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create the Cluster"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"gcloud container clusters create ${CLUSTER_NAME} --logging=SYSTEM,API_SERVER --num-nodes=3 --enable-autoupgrade --machine-type=e2-standard-2 --region=us-central1 --preemptible --service-account=${SERVICE_ACCOUNT}")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set kubectl config access"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"gcloud container clusters get-credentials ${CLUSTER_NAME} --zone=us-central1-c")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create Kubernetes Namespaces"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"kubectl create namespace ${PYRSIA_NAMESPACE}")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"kubectl create namespace ${EXTERNALDNS_NAMESPACE}")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create DNS Zone"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"gcloud dns managed-zones create pyrsia-zone --project ${PROJECT} --description ${PYRSIA_BASE_DOMAIN} --dns-name=${PYRSIA_BASE_DOMAIN}. --visibility=public")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Print list of name servers"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"gcloud dns record-sets list --project ${PROJECT} --zone pyrsia-zone --name \"${PYRSIA_BASE_DOMAIN}.\" --type NS --format \"value(rrdatas)\" | tr ';' '\\n'")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create round robin DNS name"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'gcloud dns --project=${PROJECT} record-sets create ${PYRSIA_BOOTDNS}. --zone=pyrsia-zone --type="CNAME" --ttl="300" --routing-policy-type="WRR" --routing-policy-data="50.0=${PYRSIA_NODE_ZERO}."')))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add DNS Admin to Service Account\n",(0,r.kt)("inlineCode",{parentName:"p"},"gcloud projects add-iam-policy-binding ${PROJECT} --member serviceAccount:${SERVICE_ACCOUNT} --role roles/dns.admin"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Generate Pyrsia Keys using openssl v3"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/local/Cellar/openssl@3/3.0.7/bin/openssl genpkey -algorithm Ed25519 -out ed25519.pem\n/usr/local/Cellar/openssl@3/3.0.7/bin/openssl pkey -in ed25519.pem -pubout -outform DER | tail -c +13 > id_ed25519.pub\n/usr/local/Cellar/openssl@3/3.0.7/bin/openssl pkey -in ed25519.pem -out - -outform DER | tail -c +17 > id_ed25519.pri\ncat id_ed25519.pri id_ed25519.pub > ed25519.ser\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Deploy Pyrsia via Helm"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"helm repo update pyrsia-nightly")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'helm upgrade node1 --install -n pyrsia-node pyrsia-nightly/pyrsia-node --set "domain=${PYRSIA_DOMAIN}" --set bootdns=${PYRSIA_BOOTDNS} --set keys.p2p=$(cat ed25519.ser | base64) --set keys.blockchain=$(cat ed25519.ser | base64) --version "${CHART_VERSION}"')))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"(Optional) Deploy Build Service via Helm"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'helm upgrade build1 --install -n pyrsia-node pyrsia-nightly/pyrsia-build-service --set bootdns=${PYRSIA_BOOTDNS} --version "${BUILD_CHART_VERSION}"'))))))}m.isMDXComponent=!0},11748:(e,t,a)=>{var n={"./locale":89234,"./locale.js":89234};function r(e){var t=l(e);return a(t)}function l(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=l,e.exports=r,r.id=11748}}]);